<div class="container">
  <div class="row">
    <div class="col-md-3">
      <h5><%= link_to "新規投稿", new_post_path, class: "fa-solid fa-square-plus" %></h5>
      <p>
        ジャンルで絞り込む
        <%= form_tag posts_path, method: :get, class: "boards_searchForm" do %>
          <%= select_tag :tag_id,
              options_from_collection_for_select(Tag.all, :id, :genre, params[:tag_id]),
              {
                prompt: "ジャンルで絞り込み",
                onchange: 'submit(this.form);'
              }
          %>
        <% end %>
      </p>

<!--検索ふぉーむ実装中-->
      <div class="search_form">
        <%= search_form_for @q, url: search_admin_posts_path do |f| %>
        <ul>
          <li class="search-nav-content">
            <p><%= f.label "ジャンル" %></p>
            <%= f.collection_check_boxes :post_tags_tag_id_in, Tag.all, :id, :genre, {} do |c| %>
              <%= c.label {c.check_box + c.text} %>
            <% end %>
          </li>
          <li class="search-nav-content">
            <p><%= f.label :address_start, "所在地" %></p>
            <%= f.search_field :address_start, placeholder: "東京都" %>
          </li>
        </ul>
          <%= f.submit '検索' %>
        <% end %>
      </div>
<!--ここまで-->

    </div>
    <div class="col-md-9">
      <h3 class="title">投稿一覧</h3>
        <div class="row">
          <% @results.each do |post| %>
            <div class="col-md-3">
              <div class="post_list">
                <%= link_to post_path(post.id) do %>
                  <% if post.image.attached? %>
                    <%= image_tag post.image, size: "140x140" %>
                  <% else %>
                    <%= image_tag 'no_image', size: "140x140" %>
                  <% end %>
                <% end %>
              </div>
            </div>
            <div class="col-md-9">
              <div class="post_list">
                <table>
                  <tbody>
                    <tr>
                      <th>店名:</th>
                      <td><%= post.store_name %></td>
                    </tr>
                    <tr>
                      <th>営業日:</th>
                      <td>
                        <%  weekly_columns.each_with_index do |day,i| %>
                          <% if post[day] == true %>
                           <a><%= ["月","火","水","木","金","土","日"][i] %></a>
                          <% end %>
                        <% end %>
                      </td>
                    </tr>
                    <tr>
                      <th>営業時間</th>
                      <td><%= post.business_time %></td>
                    </tr>
                    <tr>
                      <th>ジャンル:</th>
                      <td>
                        <!--ジャンル-->
                        <% post.tags.each do |tag| %>
                          <%= tag.genre %>
                        <% end %>
                        <!--ジャンル-->
                      <td>
                    </tr>
                    <tr>
                      <th>所在地:</th>
                      <td><%= post.address %></td>
                    </tr>
                    <tr>
                      <th>評価平均:</th>
                      <td>
                        <% if post.reviews.exists? %>
                          <%= post.reviews.average(:star) %>
                        <%else%>
                          ー
                        <% end %>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          <% end %>
      </div>
    </div>
  </div>
</div>

