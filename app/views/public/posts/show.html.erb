<div class="container">
  <div class="row">
    <div class="col-md-5">
      <h4>投稿者：
        <%= link_to list_customer_path(@post.customer.id) do %>
          <%= @post.customer.name  %>さん
        <% end %>
      </h4>
      <% if @post.customer == current_customer %>
        <%= link_to "投稿編集", edit_post_path(@post.id), class: "btn btn-success" %>
      <% end %>
      <!--<div class="bookmark">-->
        <% if @post.bookmarked_by?(current_customer) %>
          <td>
            <%= link_to post_bookmark_path(@post), method: :delete do %>
             <i class="fas fa-heart unlike-btn"></i>
            <% end %>
          </td>
        <% else %>
          <td>
            <%= link_to post_bookmarks_path(@post), method: :post do %>
              <i class="far fa-heart like-btn" ></i>
            <% end %>
          </td>
        <% end %>
        <%= @bookmarks_count %>件のいいね！
        <!--</div>-->
      <p>
        <% if @post.image.attached? %>
          <%=link_to @post.image,  "data-lightbox": @post.image do %>
            <%= image_tag @post.image, size: "150x150" %>
          <% end %>
        <% else %>
          <%= image_tag "no_image", size: "150x150" %>
        <% end %>
      </p>
      <p>
        店名
        <%= @post.store_name %>
      </p>
      <p>
        営業日
        <%  weekly_columns.each_with_index do |day,i| %>
          <% if @post[day] == true %>
           <a><%= ["月","火","水","木","金","土","日"][i] %></a>
          <% end %>
        <% end %>
      </p>
      <p>
        営業時間
        <%= @post.business_time %>
      </p>
      <p>
        定休日
        <%= @post.holiday %>
      </p>
      <p>
        ジャンル
        <% @post.tags.each do |tag| %>
          <%= tag.genre %>
        <% end %>
      </p>
      <p>
        コメント
        <%= @post.post_comment %>
      </p>
      <!--ここから地図機能表示(開発途中)-->
      <div type="text/javascript">
        <script>
          function initMap(){
            let map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 100, lng: 50 },
            // center: {lat: <%= @post.latitude %>, lng: <%= @post.longitude %> },
            zoom: 15
            });
          }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js"></script>
        <!--<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY'] %>&callback=initMap" async defer></script>-->
      </div>
      <!--ここまで地図機能-->
      <h5>レビュー投稿</h5>
      <%= form_with model: @review, local: :true do |f| %>
      <!--ここからが星レビュー機能-->
        <%= f.label "写真を追加" %>
        <%= f.file_field :image, accept: "image/*" %><br>
        <%= f.label :star, "評価" %>
        <div class="form-group" id="star">
          <%= f.hidden_field :star, id: :review_star %>
        </div>
        <script>
          $('#star').empty();
          var elem = document.getElementById("star");
          var opt = {
            size : 36,
            starOff: "<%= asset_path('star-off.png') %>",
            starOn: "<%= asset_path('star-on.png') %>",
            scoreName: 'review[star]',
            half: false,
          };
          raty(elem, opt)
        </script>
      <!--ここまでが星レビュー機能-->
        <%= f.label :review_comment, "口コミ内容" %><br>
        <%= f.text_area :review_comment %>
        <%= f.hidden_field :post_id, value: @post.id %>
        <%= f.submit "送信" %>
      <% end %>
    </div>

    <div class="col-md-7">
      <div class="title">
        <h4>レビュー一覧</h4>
      </div>
      <% @reviews.each do |r| %>
      <div class="border border-dark">
        投稿日時:<%= r.created_at.strftime("%Y/%m/%d %H:%M") %>
        <% if r.customer.image.attached? %>
          <%= image_tag r.customer.image, size: "50x50" %>
        <% else %>
          <%= image_tag "no_image", size: "50x50" %>
        <% end %>
        <%= link_to list_customer_path(r.customer.id) do %>
          <%= r.customer.name %>
        <% end %>

        <script>
          $('#star').empty();
          var elem = document.getElementById("star");
          var opt = {
            size: 36,
            starOff: "<%= asset_path('star-off.png') %>",
            starOn: "<%= asset_path('star-on.png') %>",
            readOnly: true,   # 読み取り専用
            score: <%= r.star %>,   # 星評価の表示
          });
        </script>
        <%= r.star %>

        <% if r.customer == current_customer %>
          <%= link_to "削除", review_path(r.id), method: :delete, class: "btn btn-danger" %>
        <% end %><br>

        <% if r.image.attached? %>
          <%= link_to r.image, "data-lightbox": r.image do %>
            <%= image_tag r.image, size: "80x80" %>
          <% end %>
        <% else %>
          <%= image_tag "no_image", size: "80x80" %>
        <% end %>
        <%= r.review_comment %>
      </div>
      <% end %>
    </div>
  </div>
</div>
